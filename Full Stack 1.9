# To implement Continuous Integration and Continuous Deployment (CI/CD) using GitHub 
Actions for a full stack project. 

// server.js
const express = require('express');
const app = express();

// Heroku provides the PORT environment variable
const PORT = process.env.PORT || 3000;

app.get('/', (req, res) => {
  res.status(200).send('Welcome to the CI/CD Project!');
});

app.get('/api/data', (req, res) => {
  res.status(200).json({ message: 'This is some sample API data.' });
});

// Only start server when run directly (prevents auto start during tests)
if (require.main === module) {
  app.listen(PORT, () => {
    console.log(`Server is running on http://localhost:${PORT}`);
  });
}

module.exports = app; // Export for testing


git init
git add .
git commit -m "Initial commit: setting up project for CI/CD"
git branch -M main
git remote add origin https://github.com/your-username/cicd-project.git
git push -u origin main


# .github/workflows/main.yml
name: Node.js CI/CD Pipeline

# Run workflow on push or pull request to main branch
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # ---- Build & Test Job ----
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout code
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Setup Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"
          cache: "npm"   # Speeds up builds

      # Step 3: Install dependencies
      - name: Install dependencies
        run: npm install

      # Step 4: Run tests
      - name: Run tests
        run: npm test

  # ---- Deployment Job ----
  deploy:
    needs: build-and-test
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout code for deployment
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Deploy to Heroku
      - name: Deploy to Heroku
        uses: akhileshns/heroku-deploy@v3.12.12
        with:
          heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
          heroku_app_name: ${{ secrets.HEROKU_APP_NAME }}
          heroku_email: ${{ secrets.HEROKU_EMAIL }}
